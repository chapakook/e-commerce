# 🛒 E-Commerce API Specification

## 📚 API 명세서 (API Specification)
- [👤 유저 (Users)](#-유저-users)
- [💰 포인트 (Points)](#-포인트-points)
- [🏷️ 브랜드 (Brands)](#-브랜드-brands)
- [🛍️ 상품 (Products)](#-상품-products)
- [❤️ 좋아요 (Like)](#-좋아요-like)
- [🧾 주문 / 결재 (Orders & Payments)](#-주문--결재-orders--payments)
- [🛒 장바구니 (Cart)](#-장바구니-cart)
- [🎟️ 쿠폰 (Coupons)](#-쿠폰-coupons)

## 👤 유저 (Users)
### 회원가입
#### Endpoint
- POST `/api/v1/users`

#### Headers
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "userId": "chasu",
  "gender": "F",  
  "birthDate": "1996-12-23",
  "email": "chasu@chasu.com"
}
```
- `userId` : 3~20자, 영문/숫자, 전역 유일
- `gender` : M(남), F(여),
- `birthDate` : `yyyy-MM-dd`, 현재 날짜 기준 과거여야 함
- `email` : 이메일 형식, 최대 100자, 전역 유일

#### Response
- `201 Created`

#### Errors
- `400 Bad Request`: 요청값 누락, 이메일 형식 오류
- `409 Conflict`: `userId` 또는 `email` 중복

### 프로필 조회
#### Endpoint
- GET `/api/v1/users/me`

#### Headers 
- `X-USER-ID`: `string`
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Response
- `200 OK`
```json
{
  "id": "chasu",
  "gender": "F",
  "birthDate": "1996-12-23",
  "email": "chasu@chasu.com"
}
```

#### Errors
- `404 Not Found`: 유저 없음

## 💰 포인트 (Points)
### 포인트 충전
#### Endpoint
- POST `/api/v1/points/charge`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "amount": 10000,
  "requestId": "550e8400-e29b-41d4-a716-446655440000"
}
```
- `amount`: 충전 금액 (정수, 0 초과 필수)
- `requestId`: 멱등 키 (UUID 권장, 중복 요청 방지)

#### Response
- `200 OK`
```json
{
  "balance": 15000
}
```

#### Errors
- `400 Bad Request`: `amount ≤ 0`, 필드 누락/형식 오류
- `409 Conflict`: 동일 `requestId`로 이미 처리됨

### 포인트 조회
#### Endpoint
- GET `/api/v1/points`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "balance": 15000,
  "retrievedAt": "2025-09-04T12:00:00Z"
}
```

#### Errors
- `400 Bad Request`: 잘못된 헤더(`X-USER-ID` 누락/빈값)

### 포인트 내역 조회
#### Endpoint
- GET `/api/v1/points/history?page=0&size=20`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "content": [
    {
      "type": "CHARGE",
      "amount": 10000,
      "balance": 15000,
      "orderId": null,
      "occurredAt": "2025-09-04T12:00:00Z"
    },
    {
      "type": "USE",
      "amount": 5000,
      "balance": 10000,
      "orderId": "ORD-001",
      "occurredAt": "2025-09-04T12:30:00Z"
    }
  ],
  "page": 0,
  "size": 20,
  "totalElements": 2,
  "totalPages": 1
}
```

#### Errors
- `400 Bad Request`: 잘못된 파라미터 (`page` < 0, `size` ≤ 0 등)

## 🏷️ 브랜드 (Brands)
### 브랜드 등록
#### Endpoint
- POST `/api/v1/brands`

#### Headers
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "name": "브랜드명"
}
```
- `name`: 길이 2~50, 전역 유일

#### Response
- `201 Created`

#### Errors
- `400 Bad Request`: `name` 누락/길이 제약 위반
- `409 Conflict`: 동일 `name` 이미 존재

### 브랜드 상세 조회
#### Endpoint
- GET `/api/v1/brands/{brandId}?include=options`

#### Headers
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "id": "BR-001",
  "name": "브랜드명",
  "products": [
    {
      "uniSku": "UNI-01H8ZK7E9ABC",
      "name": "나이키 드라이핏 티셔츠",
      "price": 29900,
      "totalLikes": 12,
      "options": [
        { "sku": "SKU-01H8-1MWH", "color": "White", "size": "M", "price": 29900, "stock": 10 }
      ]
    }
  ]
}
```

#### Errors
- `404 Not Found`: `brandId`에 해당하는 브랜드 없음

## 🛍️ 상품 (Products)
### 상품 등록
#### Endpoint
- POST `/api/v1/products`

#### Headers
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "brandId": "BR-001",
  "name": "나이키 드라이핏 티셔츠",
  "description": "경량/흡습",
  "images": ["https://.../1.jpg"],
  "options": [
    { "color": "White", "size": "M", "price": 29900, "initialStock": 10 },
    { "color": "White", "size": "L", "price": 29900, "initialStock": 8 },
    { "color": "Black", "size": "M", "price": 31900, "initialStock": 5 }
  ]
}
```
- `brandId` 유효
- `name` 2~100자
- `options ≥ 1`, `(color,size)` 조합 유일
- `price ≥ 0`, `initialStock ≥ 0`

#### Response
- `201 Created`
  - `Headers`: `Location: /api/v1/products/{uniSku}`

#### Errors
- `400 Bad Request`: 필드 누락/형식/길이/음수 금액·재고
- `404 Not Found`: `brandId` 없음
- `409 Conflict`: 옵션 조합 중복

> 생성 후 옵션별 sku가 필요하면 GET /api/v1/products/{uniSku}?include=options로 조회하세요.

### 상품 목록 조회
#### Endpoint
- GET `/api/v1/products?page=0&size=20&sort=LATEST&brandId=BR-001&include=options`

#### Headers
- `Accept`: `application/json`

#### Query Params
- `brandId` (`optional`) : 특정 브랜드 필터
- `page`: `default` 0, 
- `size`: `default` 20
- `sort`: `LATEST` | `PRICE_ASC` | `PRICE_DESC` | `LIKES_DESC`
- `include=options` (`optional`): 각 상품의 SKU 요약 포함

#### Response
- `200 OK`
```json
{
  "content": [
    {
      "uniSku": "UNI-01H8ZK7E9ABC",
      "brandId": "BR-001",
      "name": "나이키 드라이핏 티셔츠",
      "price": 29900,
      "totalLikes": 12,
      "options": [
        { "sku": "SKU-01H8-1MWH", "color": "White", "size": "M", "price": 29900, "stock": 10 }
      ]
    }
  ],
  "page": 0, "size": 20, "totalElements": 1, "totalPages": 1
}
```

#### Errors
- `400 Bad Request`: 잘못된 파라미터

### 상품 상세 조회
#### Endpoint
- GET `/api/v1/products/{uniSku}?include=options`

#### Headers
- `Accept`: `application/json`

#### Query Params
- `include=options` 미전달 시 `options` 생략(요약 응답)

#### Response
- `200 OK`
```json
{
  "uniSku": "UNI-01H8ZK7E9ABC",
  "brandId": "BR-001",
  "name": "나이키 드라이핏 티셔츠",
  "description": "경량/흡습",
  "images": ["https://.../1.jpg"],
  "price": 29900,
  "totalLikes": 12,
  "options": [
    { "sku": "SKU-01H8-1MWH", "color": "White", "size": "M", "price": 29900, "stock": 10 },
    { "sku": "SKU-01H8-1LWH", "color": "White", "size": "L", "price": 29900, "stock": 8 },
    { "sku": "SKU-01H8-1MBK", "color": "Black", "size": "M", "price": 31900, "stock": 5 }
  ]
}
```
#### Errors
- `404 Not Found`: `{uniSku}` 없음

## ❤️ 좋아요 (Like)
### 좋아요 등록
#### Endpoint
- POST `/api/v1/like/products/{uniSku}`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`

```json
{
  "liked": true,
  "productUniSku": "UNI-01H8ZK7E9ABC",
  "totalLikes": 13
}
```

#### Errors
- `400 Bad Request`: `X-USER-ID` 누락/빈 값, `uniSku` 형식 오류
- `404 Not Found`: 해당 `uniSku` 상품 없음

> 이미 좋아요 상태여도 `200 OK`로 동일 응답

### 좋아요 취소
#### Endpoint
- DELETE `/api/v1/like/products/{uniSku}`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "liked": false,
  "productUniSku": "UNI-01H8ZK7E9ABC",
  "totalLikes": 12
}
```

#### Errors
- `400 Bad Request`: `X-USER-ID` 누락/빈 값, `uniSku` 형식 오류
- `404 Not Found`: 해당 `uniSku` 상품 없음

> 이미 취소 상태여도 `200 OK`로 동일 응답. 총 좋아요 수는 0 미만 불가.

### 내가 좋아요한 상품 목록 조회
#### Endpoint
- GET `/api/v1/like/products?page=0&size=20`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`

```json
{
  "content": [
    {
      "likedAt": "2025-09-04T12:00:00Z",
      "name": "나이키 드라이핏 티셔츠",
      "price": 29900,
      "totalLikes": 12,
      "uniSku": "UNI-01H8ZK7E9ABC"
    }
  ],
  "page": 0,
  "size": 20,
  "totalElements": 1,
  "totalPages": 1
}
```

#### Errors
- `400 Bad Request`: 잘못된 파라미터(`page < 0`, `size ≤ 0`)
- `400 Bad Request`: `X-USER-ID` 누락/빈 값

## 🧾 주문 / 결재 (Orders & Payments)
### 주문 요청
#### Endpoint
- POST `/api/v1/orders`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "items": [
    { "sku": "SKU-01H8-1MWH", "quantity": 2 },
    { "sku": "SKU-01H8-1LWH", "quantity": 1 }
  ],
  "couponId": "CPN-001"
}
```
- `items ≥ 1`
- `quantity ≥ 1`
- `sku`: 유효/판매가능

#### Response
- `201 Created`
```json
{
  "orderId": "ORD-001",
  "status": "CREATED",
  "amounts": { "itemsTotal": 89700, "couponDiscount": 5000, "payable": 84700 },
  "items": [
    { "sku": "SKU-01H8-1MWH", "quantity": 2, "unitPrice": 29900, "subtotal": 59800 },
    { "sku": "SKU-01H8-1LWH", "quantity": 1, "unitPrice": 29900, "subtotal": 29900 }
  ],
  "createdAt": "2025-09-04T12:00:00Z"
}
```

#### Errors
- `400 Bad Request`: 본문 오류(`quantity ≤ 0` 등)
- `404 Not Found`: 존재하지 않는 `sku` / `couponId`
- `409 Conflict`: 재고 부족, 쿠폰 사용 불가

### 주문 목록 조회
#### Endpoint
- GET `/api/v1/orders?page=0&size=20`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "content": [
    {
      "orderId": "ORD-001",
      "status": "CREATED",
      "amounts": { "itemsTotal": 89700, "couponDiscount": 5000, "payable": 84700 },
      "createdAt": "2025-09-04T12:00:00Z"
    }
  ],
  "page": 0, "size": 20, "totalElements": 1, "totalPages": 1
}
```

### 주문 상세 조회
#### Endpoint
- GET `/api/v1/orders/{orderId}`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "orderId": "ORD-001",
  "status": "CREATED",
  "amounts": { "itemsTotal": 89700, "couponDiscount": 5000, "payable": 84700 },
  "items": [
    { "sku": "SKU-01H8-1MWH", "quantity": 2, "unitPrice": 29900, "subtotal": 59800 },
    { "sku": "SKU-01H8-1LWH", "quantity": 1, "unitPrice": 29900, "subtotal": 29900 }
  ],
  "createdAt": "2025-09-04T12:00:00Z"
}
```

#### Errors
- `404 Not Found`: `orderId` 없음

## 🛒 장바구니 (Cart)
### 장바구니 추가
#### Endpoint
- POST `/api/v1/cart/items`

#### Headers
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{ 
  "sku": "SKU-01H8-1MWH", 
  "quantity": 2
}
```
- `quantity ≥ 1`, 동일 `sku` 존재 시 수량 증가

#### Response
- `200 OK`
```json
{
  "cartId": "CART-001",
  "items": [
    { "itemId": "CI-1", "sku": "SKU-01H8-1MWH", "quantity": 2, "unitPrice": 29900, "subtotal": 59800 }
  ],
  "totalAmount": 59800
}
```

#### Errors
- `404 Not Found`: `sku` 없음/판매불가
- `400 Bad Request`: 수량 오류

### 장바구니 조회
#### Endpoint
- GET `/api/v1/cart`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "cartId": "CART-001",
  "items": [
    { "itemId": "CI-1", "sku": "SKU-01H8-1MWH", "quantity": 2, "unitPrice": 29900, "subtotal": 59800 }
  ],
  "totalAmount": 59800
}
```

### 장바구니 수정
#### Endpoint
- PATCH `/api/v1/cart/items/{itemId}`

#### Headers
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{ "quantity": 3 }
```
- `quantity ≤ 0` 해당 항목 삭제

#### Response
- `200 OK`

### 장바구니 삭제
#### Endpoint
- DELETE `/api/v1/cart/items/{itemId}`

#### Headers
- `X-USER-ID`: `string`

#### Response
- `204 No Content`

## 🎟️ 쿠폰 (Coupons)
### 쿠폰 발급
#### Endpoint
- POST `/api/v1/coupons/issue`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`
- `Content-Type`: `application/json`

#### Request Body
```json
{
  "templateCode": "WELCOME10"
}
```
- `templateCode` 유효해야 함, 유저당 동일 템플릿 1장

#### Response
- `200 OK`
```json
{
  "couponId": "CPN-001",
  "code": "WELCOME10",
  "type": "fixed",
  "value": 1000,
  "validFrom": "2025-09-01T00:00:00Z",
  "validUntil": "2025-09-30T23:59:59Z",
  "issuedAt": "2025-09-04T12:00:00Z",
  "usable": true
}
```

#### Errors
- `400 Bad Request`: `templateCode` 누락/형식 오류
- `404 Not Found`: 존재하지 않는 `templateCode`
- `409 Conflict`: 동일 템플릿으로 이미 발급됨(유저당 1장)

> 할인 방식: 정액(`fixed`), 정율(`rate`)
> 적용 범위: 전 상품(`all`)
> 정율(`rate`)은 원 단위 절사

### 쿠폰 조회
#### Endpoint
- GET `/api/v1/coupons/{couponId}`

#### Headers
- `X-USER-ID`: `string`
- `Accept`: `application/json`

#### Response
- `200 OK`
```json
{
  "couponId": "CPN-001",
  "code": "WELCOME10",
  "type": "fixed",
  "value": 1000,
  "validFrom": "2025-09-01T00:00:00Z",
  "validUntil": "2025-09-30T23:59:59Z",
  "status": "ISSUED",
  "usable": true,
  "usedAt": null,
  "appliedOrderId": null
}
```

#### Errors
- `400 Bad Request`: `couponId` 형식 오류
- `404 Not Found`: 존재하지 않거나(또는 본인 소유 아님) 조회 불가한 쿠폰

> 주문 시 쿠폰 적용은 주문 생성 API에서 `couponId`(또는 `code`)로 전달하며, 동시 적용 1개만 허용.